{% extends 'shop/base.html' %}
{% block title %}iShop-Shopping Mart{% endblock %}

{% block css %}
        .col-md-3 {
            display: inline-block;
            margin-left: -4px;
        }
        .col-md-3 img{
            width: 260px;
            height: 260px;
            margin: auto;
            margin-top: 10px;
        }
        .carousel-control-prev , .carousel-control-next{
            top: auto;
            bottom: auto;
            padding-top: 250px;
        }

        body .carousel-indicator li {
            background-color: blue;
          }

        body .carousel-control-prev-icon,
        body .carousel-control-next-icon {
          background-color: #0303c8;
          height: 28px;
          width: 25px;
        }
        
        body .no-padding {
            padding-left: 0;
            padding-right: 0;
        }

        .carousel-control-prev-icon {
            background: black no-repeat center center;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 8 8'%3e%3cpath d='M5.25 0l-4 4 4 4 1.5-1.5-2.5-2.5 2.5-2.5-1.5-1.5z'/%3e%3c/svg%3e");
        }

        body{
            background-color: #dcdcdc;
        }
        .carousel-control-next-icon {
            background: black no-repeat center center;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 8 8'%3e%3cpath d='M2.75 0l-1.5 1.5 2.5 2.5-2.5 2.5 1.5 1.5 4-4-4-4z'/%3e%3c/svg%3e");
        }
        body .carousel-indicators{
        bottom:0;
        }
        .styling{
            margin-bottom: -1.2rem;
            margin-left: 20px;
            margin-top: 10px;
        }
        .popover-body{
          color: #130a6c;
          font-weight:600;
          font-size: 20px;
          font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        }
        .carousel-indicators .active{
        background-color: blue;
        }

        .center{
          text-align:center;
          margin:20px 0;
        }
        p{
          font-size: 20px;
          display: flex;
          font-weight: 500;
          justify-content: center;
        }
        .s1, .s2, .s3{
          height: 30vh;
          text-align: center;
          width: 18vw;
          font-size: 25px;
          border: 3px solid rgb(0, 0, 12);
          display: flex;
          background-color: rgb(242, 199, 143);
          font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
          justify-content: center;
          align-items: center;
          padding: 8px;
          margin: 10px 0;
          cursor: pointer;
        }
        .section{
          display: flex;
          justify-content: space-evenly;
          align-items: center;
        }
        .line{
          font-size:48px;
        }
        .div1{
          height:40px;
          font-size: 22px;
          background-color: rgb(30, 30, 30);
          color: white;
          text-align: center;
        }
    {% endblock %}
{% block body %}
{% load static %}

<!--carousel indicators starts from here-->
{% comment %} <div class="header">
  <h2 class="center">Hello and Welcome to iShop E-Commerce Shopping Website.</h2>
  <p>We are here with Best Offers and Discount in Home Appliances, Electronics, Accessories, etc </p>
  <div class="section">
    <div class="s1">Fast and Furious Service</div>
    <div class="s2">Budget-Friendly</div>
    <div class="s3">Great Offers and Discount</div>
  </div>
</div>
   <div class="line">____________________________________________________________________________</div> {% endcomment %}
<div class="container" xmlns:data="http://www.w3.org/1999/xhtml">
    {% for product,range,nSlides in allProds %}
    <h2 class="styling">Flash Sale on {{ product.0.category }}!!!</h1>
      <div class="row">
    <div id="demo{{forloop.counter}}" class="carousel slide my-3" data-ride="carousel">'
        <ul class="carousel-indicators">
            <li data-target="#demo{{forloop.counter}}" data-slide-to="0" class="active"></li>

    {% for i in range %}
       <li data-target="#demo{{forloop.parentloop.counter}}" data-slide-to="{{i}}" ></li>
    {% endfor %}
</ul>
      <div class="carousel-inner">
        <div class="carousel-item active">
            
            {% comment %} <div class="col-xs-3 col-sm-3 col-md-3">
              <div class="card" style="width: 18rem;">
                <img src='/media/{{product.0.image}}' class="card-img-top" alt="...">
                <div class="card-body">
                  <h5 class="card-title">{{ product.0.product_name }}</h5>
                  <h5 class="card-price">₹ {{ product.0.price }}</h5>
                  <p class="card-text">{{ product.0.desc }}</p>
                  <button id="pr{{product.0.id}}" class="btn btn-primary cart">Add to Cart</button>
                </div>
              </div>
            </div> {% endcomment %}

            {% for i in product %}
            <div class="col-xs-3 col-sm-3 col-md-3">
              <div class="card align-items-center" style="width: 18rem;">
                <img src='/media/{{i.image}}' class="card-img-top" alt="...">
                <div class="card-body">
                  <h5 class="card-title" id='namepr{{i.id}}'>{{ i.product_name }}</h5>
                  <h5 class="card-price">₹ {{ i.price }}</h5>
                  <p class="card-text">{{ i.desc|slice:"0:20"}}...</p>
                  <span id="divpr{{i.id}}" class="divpr">
                  <button id="pr{{i.id}}" class="btn btn-primary cart">Add to Cart</button>
                  </span>
                  <a href="/shop/products/{{i.id}}"><button id="qv{{i.id}}" class="btn btn-primary mx-1 cart">Quickview</button></a>
                </div>
              </div>
            </div>

            {% if forloop.counter|divisibleby:4 and forloop.counter > 0 and not forloop.last %}
             </div><div class="carousel-item">
            {% endif%}

            {% endfor %}
      </div>

      </div>
        </div>

<a class="carousel-control-prev " href="#demo{{forloop.counter}}" role="button" data-slide="prev">
   <span class="carousel-control-prev-icon" aria-hidden="true" ></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="carousel-control-next" href="#demo{{forloop.counter}}" role="button" data-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="sr-only">Next</span>
  </a>
</div>
  {% endfor %}
</div>
 <footer>
  <div class="div1">Copyright &copy; 2023 www.iShop.com- All Rights reserved</div>
  <div class="socials"><i id="S1" class="fa fa-facebook-square"></i>
  <i id="S2" class="fa fa-instagram"></i>
  <i id="S3" class="fa fa-twitter"></i>
</div>
</footer>
 {% endblock %}

 {% block js %}
   <script>
    {% comment %} console.log("Working"); {% endcomment %}
    if (localStorage.getItem('cart') == null) {
      var cart = {};
    }
    else
    {
      cart = JSON.parse(localStorage.getItem('cart'));
       //document.getElementById('cart').innerHTML = Object.values(cart).reduce((previous,current)=> previous+current)
       updateCart(cart);
    }

    $('.divpr').on('click', 'button.cart', function(){
      var idstr = this.id.toString();
      if(cart[idstr]!= undefined){
        qty = cart[idstr][0]+1;
      }
      else{
        qty = 1;
        name = document.getElementById('name'+idstr).innerHTML;
        cart[idstr] = [qty,name]; 
      }
      updateCart(cart);
      
    });
    $('#popcart').popover('show');
    var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-toggle="popover"]'))
        var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
          return new bootstrap.Popover(popoverTriggerEl)
        })
    updatePopover(cart);
    function updatePopover(cart){
      var popstr = ""
      popstr = popstr + "<h5> Items inside Cart: </h5><div class='mx-2 my-2'>";
        var i = 1;
        for(var item in cart)
        {
          popstr = popstr + "<b>"+ i +"</b>" + ".  "
          popstr += document.getElementById("name" + item).innerHTML.slice(0,20) + " Qty:" + cart[item][0] + '<br>';
          i = i+1;
        }
        
        popstr = popstr + "</div> <a href='/shop/checkout'><button class='btn btn-primary' id='checkout'>Checkout</button></a> <button class='btn btn-primary' onclick='clearCart()' id='clearCart'>ClearCart</button>        "
        document.getElementById('pop-cart').setAttribute('data-content', popstr);
        $('#popcart').popover('show')
        /* var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-toggle="popover"]'))
        var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
          return new bootstrap.Popover(popoverTriggerEl)
        }) */ 
        // updateCart(cart)
        {% comment %} clearCart(); {% endcomment %}
    }

    function clearCart(){
      cart = JSON.parse(localStorage.getItem('cart'))
      for(var item in cart)
      {
        document.getElementById('div' + item).innerHTML ='<button id="'+ item +'" class="btn btn-primary cart">Add to Cart</button>';
      }
      localStorage.clear();
      cart = {};
      updateCart(cart);
      updatePopover(cart);
    }
    function updateCart(cart){
      var sum = 0;
      for(var item in cart){
        sum = sum + cart[item][0]
        document.getElementById('div'+item).innerHTML = "<button id='minus" + item + "' class='btn btn-primary minus'>-</button> <span id ='val" + item + "''>" +cart[item][0] + "</span> <button id='plus" + item +"' class='btn btn-primary plus'> + </button>"     
       }
       localStorage.setItem('cart',JSON.stringify(cart));
       // document.getElementById('cart').innerHTML = Object.keys(cart).length;
       // document.getElementById('cart').innerHTML = Object.values(cart).reduce((previous,current)=> previous+current);
        document.getElementById('cart').innerHTML = sum;
        updatePopover(cart);
    }

    $('.divpr').on("click" , "button.minus", function(){
      a = this.id.slice(7, )
      cart['pr'+a][0] -= 1;
      cart['pr'+a][0] = Math.max(0,cart['pr'+a][0])
      document.getElementById('valpr'+a).innerHTML = cart['pr'+a][0];
      updateCart(cart);
    });
    
    $('.divpr').on("click" , "button.plus", function(){
      a = this.id.slice(6, )
      cart['pr'+a][0] += 1;
      document.getElementById('valpr'+a).innerHTML = cart['pr'+a][0];
      updateCart(cart);
    });

   </script>
 {% endblock  %}
